# Thread

프로세스를 구성하는 실행 흐름의 단위이다.

하나의 프로세스는 하나 이상의 스레드를 가질 수 있다.

## 단일 스레드

실행 흐름이 하나인 프로세스

- 메모리
    
    메모리 안에 웹브라우저 프로세스 , 게임 프로세스, 워드 프로세서 프로세스 등등 내부에 여러 스레드를 동시에 실행 가능하다.
    

## 멀티 스레드

실행 흐름이 여러개인 프로세스

## 스레드의 구성 요소

스레드 ID 프로그램 카운터를 비롯한 레지스터 값 스택 실행에 필요한 최소한의 스택

각기 다른 스레드 마다 각기 다른 프로그램 카운터 및 스택을 가지고 있다

각기 다른 카운터 및 스택 영역을 가지고 있지만 프로세스의 내부 자원을 공유할 수 있다.

리눅스 운영체제에서의 스레드 경우에는 프로세스와 스레드의 별개의 것으로 구분할 이유가 없다. 프로세스와 스레드는 그냥 실행의 문맥일 뿐이다. 단지 task라는 용어로 사용한다.

CPU에게 처리해야할 작업을 전달할 때 사실 스레드 단위로 전달한다

### 멀티 프로세스와 멀티 스레드의 차이

동일한 작업을 수행하는 단일 스레드 프로세스 여러 개 실행하는 것과 하나의 프로세스를 여러 스레드로 실행하는 것에 어떻나 차이가 있을까?

일단 동일한 작업을 수행하는 단일 스레드 프로세스 여러 개의 경우 자원을 공유하지 않고 독립적으로 실행된다. 프로세스는 독립적인 형태를 가지기 때문이다. 따라서 다른 프로세스에 문제가 생기더라도 동일한 작업을 다른 프로세스에 서 할 수 있다.

하나의 프로세스에서 여러 스레드의 경우 프로세스 내부 자원을 공유하기 때문에 실행 속도가 빠르고 일부 스레드의 문제가 생가면 프로세스 전체에 문제가 생기게 된다.

### 멀티 프로세스

프로세스를 fork해서 프로세스가 3개 있다고 한다면 hello os 출력을 실행하면 모두 3번 출력이 실행된다.

프로세스를 fork 한다는 것은 코드 데이터 힙 영역 등 모든 자원이 복제되어 저장된다.

저장된 메모리 주소를 제외하면 모든 것이 동일한 프로세스 두 개가 통째로 메모리에 적재된다.

fork를 세 번 네 번하면 메모리에는 같은 프로세스가 통째로 세 개 네개가 적재된다.

- 사실은 fork 직후 같은 프로세스를 통째로 메모리에 중복 저장 하지 않으면서 동시에 프로세스끼리 자원을 공유하지 않는 방법도  존재한다. 이를 Copy on Write 기법이라고 한다.

### 멀티 스레드

그런데 스레드 같은 경우 각기 다른 ID와 스택을 가지고 있지만 나머지 자원은 공유하게 된다.

그래서 통신은 유리하지만 하나의 스레드의 문제가 생기면 모두 문제가 생기게 된다,

## 그렇다면 멀티 프로세스 간에는 통신이 어떻게 이루어 질까?

프로세스는 서로 독립적이기 때문에 IPC 통신을 하게 된다. 파일을 통한 통신이나 공유 메모리를 통한 프로세스 간 통신, 네트워크 통신 방법 등이 있다.

## Python 프로세스 다뤄보기

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c8e9c980-8f8d-482e-b09b-c51220d818af/6f8bf5c9-2ce6-4f68-8c71-f00f1c1b18b1/Untitled.png)

위의 사진 처럼 pid는 그때그때 부여해주는 것이기 때문에 값이 출력할 때 마다 계속 달라진다. 프로세스가 끝나면 PID를 수거해가기 때문이다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c8e9c980-8f8d-482e-b09b-c51220d818af/a5a9925c-d869-446b-bccd-c527934155fa/Untitled.png)

부모 프로세스가 출력 되고 자식 프로세스를 생성하면 다시 자식 프로세스가 출력 되고 자식 프로세스가 실행한 부모 프로세스가 차례로 실행된다.      

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c8e9c980-8f8d-482e-b09b-c51220d818af/46c95898-4d51-47bf-adf5-580bdf2b45ef/Untitled.png)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c8e9c980-8f8d-482e-b09b-c51220d818af/7cb7498c-f900-4fde-8692-431484d643db/Untitled.png)

자식 프로세스는 각기 다른 프로세스이기 때문에 pid는 다르지만 부모 pid 값은 같은 부모로 부터 파생되었기 때문에 부모 프로세스의 pid값은 같다.

각각 다른 프로세스들을 동시에 실행할 수도 있다. 서로 foo 외에도 서로 다른 함수를 자식 프로세스를 생성하고 target에 서로 다른 함수를 정의해서 넣어주면 해당 스크립트를 실행했을 때 모두 동시에 프로세스들이 실행된다.
